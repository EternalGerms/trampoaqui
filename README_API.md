# üìö Documenta√ß√£o Completa da API - Service Marketplace

> Documenta√ß√£o t√©cnica completa para desenvolvedores backend e frontend.

---

## üéØ Vis√£o Geral

Esta √© uma **API REST completa** para uma plataforma de marketplace de servi√ßos que conecta clientes a prestadores de servi√ßo profissionais. A plataforma permite:

- ‚úÖ Registro e autentica√ß√£o de usu√°rios
- üë∑ Cadastro de prestadores de servi√ßo em m√∫ltiplas categorias
- üìù Cria√ß√£o e gerenciamento de solicita√ß√µes de servi√ßo
- üí¨ Sistema de negocia√ß√£o de pre√ßos e condi√ß√µes
- üí≥ Processamento de pagamentos
- ‚≠ê Sistema de avalia√ß√µes
- üí∞ Gest√£o de saldo e saques para prestadores
- üëë Dashboard administrativo

---

## üìñ Documenta√ß√£o Dispon√≠vel

### 1Ô∏è‚É£ [API_DOCUMENTATION.md](./API_DOCUMENTATION.md)
**Documenta√ß√£o T√©cnica Completa**

Refer√™ncia completa de todos os endpoints, modelos de dados e fluxos de neg√≥cio.

üìã **Conte√∫do:**
- Vis√£o geral da arquitetura
- Sistema de autentica√ß√£o JWT
- Modelos de dados detalhados (schemas)
- Documenta√ß√£o de todos os endpoints
- Fluxos de neg√≥cio principais
- C√≥digos de status HTTP
- Vari√°veis de ambiente
- Seguran√ßa e boas pr√°ticas

üëâ **Use quando precisar:**
- Entender a estrutura da API
- Consultar endpoints espec√≠ficos
- Compreender os modelos de dados
- Implementar autentica√ß√£o
- Configurar ambiente

---

### 2Ô∏è‚É£ [API_EXAMPLES.md](./API_EXAMPLES.md)
**Guia Pr√°tico com Exemplos de C√≥digo**

Exemplos pr√°ticos e reutiliz√°veis para integra√ß√£o r√°pida.

üìã **Conte√∫do:**
- Setup do cliente HTTP
- Casos de uso completos (cliente e prestador)
- Snippets reutiliz√°veis (React Hooks, componentes)
- Tratamento de erros
- Boas pr√°ticas de implementa√ß√£o
- Otimiza√ß√µes de performance

üëâ **Use quando precisar:**
- Implementar funcionalidades rapidamente
- Ver exemplos de c√≥digo real
- Criar hooks React personalizados
- Entender fluxos completos na pr√°tica
- Implementar tratamento de erros

---

### 3Ô∏è‚É£ [API_TESTING_DEBUG.md](./API_TESTING_DEBUG.md)
**Guia de Testes e Debugging**

Ferramentas e t√©cnicas para testar e debugar a API.

üìã **Conte√∫do:**
- Cole√ß√µes Postman/Insomnia
- Testes automatizados (Jest + Supertest)
- Configura√ß√£o de debugging (VS Code)
- Logging e monitoramento
- Solu√ß√£o de problemas comuns
- Ferramentas √∫teis

üëâ **Use quando precisar:**
- Testar endpoints manualmente
- Escrever testes automatizados
- Debugar problemas
- Monitorar performance
- Resolver erros comuns

---

## üöÄ Quick Start

### Pr√©-requisitos

```bash
Node.js >= 18
PostgreSQL >= 14
Docker (opcional, mas recomendado)
```

### 1. Clone e Instale

```bash
# Clone o reposit√≥rio
git clone <repository-url>
cd <project-directory>

# Instale depend√™ncias
npm install
```

### 2. Configure Vari√°veis de Ambiente

```bash
# Crie arquivo .env na raiz
cp .env.example .env

# Edite com suas configura√ß√µes
nano .env
```

**Vari√°veis obrigat√≥rias:**
```env
JWT_SECRET=seu-secret-super-seguro-aqui
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
PORT=5000
NODE_ENV=development
```

### 3. Inicie o Banco de Dados

**Com Docker:**
```bash
docker-compose up -d postgres
```

**Sem Docker:**
```bash
# Certifique-se de que PostgreSQL est√° rodando
# Crie o banco de dados
createdb servicemarketplace
```

### 4. Execute Migrations

```bash
npm run db:push
```

### 5. Inicie o Servidor

**Desenvolvimento:**
```bash
npm run dev
```

**Produ√ß√£o:**
```bash
npm run build
npm start
```

### 6. Teste a API

```bash
# Health check
curl http://localhost:5000/api/health

# Listar categorias
curl http://localhost:5000/api/categories
```

---

## üìä Estrutura do Projeto

```
.
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts          # Configura√ß√£o Express
‚îÇ   ‚îú‚îÄ‚îÄ routes.ts         # Defini√ß√£o de rotas
‚îÇ   ‚îú‚îÄ‚îÄ db.ts            # Configura√ß√£o Drizzle ORM
‚îÇ   ‚îî‚îÄ‚îÄ storage.ts       # Camada de acesso a dados
‚îÇ
‚îú‚îÄ‚îÄ shared/
‚îÇ   ‚îî‚îÄ‚îÄ schema.ts        # Schemas do banco (Drizzle + Zod)
‚îÇ
‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îî‚îÄ‚îÄ src/             # Aplica√ß√£o React
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ clear-db.ts      # Scripts auxiliares
‚îÇ
‚îú‚îÄ‚îÄ .env                 # Vari√°veis de ambiente (n√£o commitar)
‚îú‚îÄ‚îÄ docker-compose.yml   # Configura√ß√£o Docker
‚îú‚îÄ‚îÄ drizzle.config.ts    # Config Drizzle
‚îî‚îÄ‚îÄ package.json
```

---

## üîë Principais Endpoints

### Autentica√ß√£o
```
POST   /api/auth/register        # Registrar usu√°rio
POST   /api/auth/login           # Login
GET    /api/auth/me              # Usu√°rio atual
POST   /api/auth/enable-provider # Habilitar prestador
PUT    /api/auth/profile         # Atualizar perfil
```

### Categorias
```
GET    /api/categories           # Listar categorias
```

### Prestadores
```
GET    /api/providers            # Listar prestadores
GET    /api/providers/:id        # Detalhes de prestador
POST   /api/providers            # Criar servi√ßo
PUT    /api/providers/:id        # Atualizar servi√ßo
DELETE /api/providers/:id        # Deletar servi√ßo
```

### Solicita√ß√µes
```
GET    /api/requests             # Solicita√ß√µes do cliente
GET    /api/requests/provider    # Solicita√ß√µes do prestador
POST   /api/requests             # Criar solicita√ß√£o
PUT    /api/requests/:id         # Atualizar solicita√ß√£o
```

### Negocia√ß√µes
```
POST   /api/negotiations                      # Criar proposta
PUT    /api/negotiations/:id/status           # Aceitar/Rejeitar
POST   /api/negotiations/:id/counter-proposal # Contra-proposta
GET    /api/requests/:id/negotiations         # Listar negocia√ß√µes
```

### Pagamentos
```
POST   /api/requests/:id/payment          # Definir m√©todo
POST   /api/requests/:id/complete-payment # Confirmar pagamento
```

### Avalia√ß√µes
```
POST   /api/reviews                      # Criar avalia√ß√£o
GET    /api/reviews/provider/:id         # Avalia√ß√µes de prestador
```

### Saldo
```
GET    /api/users/me/balance    # Ver saldo
POST   /api/withdrawals         # Solicitar saque
GET    /api/withdrawals         # Listar saques
```

### Admin
```
GET    /api/admin/dashboard     # Dashboard
GET    /api/admin/users         # Listar usu√°rios
GET    /api/admin/requests      # Listar solicita√ß√µes
PUT    /api/admin/users/:id/admin # Atualizar admin
DELETE /api/admin/users/:id    # Deletar usu√°rio
```

---

## üîê Autentica√ß√£o

A API usa **JWT (JSON Web Tokens)** para autentica√ß√£o.

### Como Autenticar

1. **Registrar ou fazer login:**
```bash
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "usuario@example.com",
    "password": "senha123"
  }'
```

2. **Receber token:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": { "id": "...", "name": "..." }
}
```

3. **Usar em requisi√ß√µes:**
```bash
curl http://localhost:5000/api/auth/me \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

---

## üí° Fluxos Principais

### Fluxo do Cliente

```mermaid
graph LR
    A[Registro] --> B[Buscar Prestadores]
    B --> C[Criar Solicita√ß√£o]
    C --> D[Negociar]
    D --> E[Pagar]
    E --> F[Receber Servi√ßo]
    F --> G[Avaliar]
```

### Fluxo do Prestador

```mermaid
graph LR
    A[Registro] --> B[Habilitar Prestador]
    B --> C[Completar Perfil]
    C --> D[Criar Servi√ßo]
    D --> E[Receber Solicita√ß√µes]
    E --> F[Negociar]
    F --> G[Realizar Servi√ßo]
    G --> H[Receber Pagamento]
```

---

## üß™ Testes

### Testes Manuais (Postman)

1. Importe a cole√ß√£o do [API_TESTING_DEBUG.md](./API_TESTING_DEBUG.md)
2. Configure as vari√°veis de ambiente
3. Execute os requests

### Testes Automatizados

```bash
# Rodar todos os testes
npm test

# Testes com coverage
npm run test:coverage

# Testes em modo watch
npm run test:watch
```

---

## üêõ Debugging

### VS Code

1. Abra o projeto no VS Code
2. Use a configura√ß√£o de debug em `.vscode/launch.json`
3. Pressione F5 para iniciar debug

### Logs

Os logs s√£o salvos em:
- `logs/error.log` - Apenas erros
- `logs/combined.log` - Todos os logs

### Ferramentas √öteis

- **Postman**: Testes de API
- **pgAdmin**: Interface PostgreSQL
- **Docker Desktop**: Gerenciar containers

---

## üìö Recursos Adicionais

### Stack Tecnol√≥gica

| Categoria | Tecnologia |
|-----------|-----------|
| Runtime | Node.js 18+ |
| Framework | Express.js |
| Linguagem | TypeScript |
| Banco de Dados | PostgreSQL 14+ |
| ORM | Drizzle ORM |
| Valida√ß√£o | Zod |
| Autentica√ß√£o | JWT |
| Containeriza√ß√£o | Docker |

### Depend√™ncias Principais

```json
{
  "express": "^4.21.2",
  "drizzle-orm": "^0.39.1",
  "jsonwebtoken": "^9.0.2",
  "bcrypt": "^6.0.0",
  "zod": "^3.24.2",
  "pg": "^8.12.0"
}
```

---

## üîß Scripts Dispon√≠veis

```bash
npm run dev           # Iniciar em desenvolvimento
npm run build         # Build para produ√ß√£o
npm start             # Iniciar produ√ß√£o
npm test              # Rodar testes
npm run db:push       # Aplicar migrations
npm run db:clear      # Limpar banco de dados
npm run docker:up     # Iniciar containers
npm run docker:down   # Parar containers
npm run docker:logs   # Ver logs dos containers
```

---

## ü§ù Contribuindo

### Padr√µes de C√≥digo

1. **TypeScript**: Sempre tipar corretamente
2. **Valida√ß√£o**: Usar Zod para todos os inputs
3. **Erros**: Retornar mensagens claras
4. **Commits**: Usar conventional commits

### Exemplo de Commit

```bash
git commit -m "feat: adicionar endpoint de notifica√ß√µes"
git commit -m "fix: corrigir c√°lculo de taxa de servi√ßo"
git commit -m "docs: atualizar documenta√ß√£o de autentica√ß√£o"
```

---

## ‚ùì Perguntas Frequentes

### Como resetar o banco de dados?

```bash
npm run db:clear
npm run db:push
```

### Como adicionar uma nova categoria?

As categorias s√£o criadas automaticamente no seed. Edite `server/routes.ts`:

```typescript
const categories = [
  { name: "Nova Categoria", icon: "fas fa-icon", slug: "nova-categoria" },
  // ...
];
```

### Como mudar a taxa da plataforma?

Edite em `server/routes.ts`:

```typescript
const platformFee = serviceAmount * 0.05; // 5% ‚Üí Altere aqui
```

### Como adicionar HTTPS?

Configure as vari√°veis de ambiente:

```env
SSL_CERT=/path/to/cert.pem
SSL_KEY=/path/to/key.pem
```

---

## üìû Suporte

### Problemas Comuns

Consulte [API_TESTING_DEBUG.md](./API_TESTING_DEBUG.md) se√ß√£o "Problemas Comuns".

### Precisa de Ajuda?

1. Verifique a documenta√ß√£o relevante
2. Procure em Issues do GitHub
3. Abra uma nova Issue com:
   - Descri√ß√£o do problema
   - Steps to reproduce
   - Logs relevantes
   - Ambiente (OS, Node version, etc.)

---

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT.

---

## üó∫Ô∏è Roadmap

### Vers√£o 1.1 (Pr√≥xima)
- [ ] WebSockets para notifica√ß√µes em tempo real
- [ ] Upload de imagens (perfil e portf√≥lio)
- [ ] Sistema de chat integrado
- [ ] Notifica√ß√µes por email

### Vers√£o 1.2
- [ ] Geolocaliza√ß√£o e busca por proximidade
- [ ] Integra√ß√£o com gateway de pagamento real
- [ ] Sistema de agendamento com calend√°rio
- [ ] App mobile (React Native)

### Vers√£o 2.0
- [ ] GraphQL API
- [ ] Microservi√ßos
- [ ] Sistema de assinaturas
- [ ] Analytics avan√ßado

---

## üìä Status do Projeto

![Build Status](https://img.shields.io/badge/build-passing-brightgreen)
![Coverage](https://img.shields.io/badge/coverage-85%25-green)
![Version](https://img.shields.io/badge/version-1.0.0-blue)
![License](https://img.shields.io/badge/license-MIT-blue)

---

## üôè Agradecimentos

Desenvolvido com ‚ù§Ô∏è para facilitar a conex√£o entre clientes e prestadores de servi√ßo.

---

**√öltima Atualiza√ß√£o**: 2024-01-01  
**Vers√£o da API**: 1.0.0  
**Documenta√ß√£o**: v1.0.0

---

## üîó Links R√°pidos

- [üìñ Documenta√ß√£o Completa](./API_DOCUMENTATION.md)
- [üíª Exemplos de C√≥digo](./API_EXAMPLES.md)
- [üß™ Testes e Debug](./API_TESTING_DEBUG.md)
- [üê≥ Docker Hub](#) (se publicado)
- [üìù Changelog](#) (se existir)
